import 'package:dokanee/core/theme/color.pallete.dart';
import 'package:dokanee/core/utils/extensions/extensions.dart'; // Assuming this is a custom extension file
import 'package:flutter/material.dart';
import '../../utils/app_space.dart';

class DokaneeGridView<T> extends StatelessWidget {
  final List<T> dataList;
  final IndexedWidgetBuilder itemBuilder;
  final int rowCount; // Added rowCount parameter for dynamic rows
  final double? itemHeight;
  final double? itemWidth;
  final BoxDecoration? itemDecoration;

  const DokaneeGridView({
    super.key,
    required this.dataList,
    required this.itemBuilder,
    required this.rowCount, // Validate rowCount
    this.itemHeight,
    this.itemWidth,
    this.itemDecoration,
  }) : assert(rowCount > 0, 'rowCount must be a positive integer');

  @override
  Widget build(BuildContext context) {
    return SingleChildScrollView(
      physics: const BouncingScrollPhysics(),
      child: Column(
        children: _buildRows(context),
      ),
    );
  }

  List<Widget> _buildRows(BuildContext context) {
    List<Widget> rows = [];
    int currentIndex = 0;

    while (currentIndex < dataList.length) {
      // Create rows with up to rowCount items
      List<Widget> currentRow = [];
      for (int i = 0; i < rowCount && currentIndex < dataList.length; i++) {
        currentRow.add(_buildItem(
          data: dataList[currentIndex],
          context: context,
          itemBuilder: itemBuilder,
          height: itemHeight,
          width: itemWidth,
          containerDecoration: itemDecoration,
        ));
        currentIndex++;
      }

      rows.add(Row(
        mainAxisAlignment: MainAxisAlignment.spaceBetween,
        children: currentRow,
      ));
    }

    return rows;
  }

  Widget _buildItem({
    BoxDecoration? containerDecoration,
    double? height,
    double? width,
    required T data,
    required IndexedWidgetBuilder itemBuilder,
    required BuildContext context,
  }) {
    return Container(
      height: height ?? 160,
      width: width ?? context.width * 0.23,
      margin: const EdgeInsets.symmetric(horizontal: 5, vertical: 5),
      decoration: containerDecoration ??
          BoxDecoration(
              borderRadius: BorderRadius.circular(20),
              color: Theme.of(context).cardTheme.color,
              boxShadow: [
                BoxShadow(
                  offset: const Offset(0, 0),
                  spreadRadius: 2,
                  blurRadius: 2,
                  color: ColorPallete.lightGrey,
                )
              ]),
      child: itemBuilder(context,
          dataList.indexOf(data)), // Call itemBuilder with currentIndex
    );
  }
}
